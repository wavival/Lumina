---
export interface CTA {
  label: string;
  href: string;
  external?: boolean;
}

import Button from '../ui/Button.astro';

interface Props {
  eyebrow: string;
  title: string;
  description?: string;

  variant?: "image" | "gradient" | "solid";
  align?: "center" | "left";

  bgImage?: string; // para variant="image"
  overlayStrength?: 0 | 20 | 30 | 40 | 50 | 60 | 70 | 80;

  primary?: CTA;
  secondary?: CTA;
  showPrimary?: boolean;
  showSecondary?: boolean;

  id?: string;
  class?: string;
}

const {
  eyebrow,
  title,
  description,
  variant = "gradient",
  align = "left",
  bgImage,
  overlayStrength = 40,
  primary,
  secondary,
  showPrimary = Boolean(primary),
  showSecondary = Boolean(secondary),
  id,
  class: cls = "",
} = Astro.props as Props;

const wrapAlign =
  align === "center"
    ? "text-center items-center justify-center"
    : "text-left items-center md:items-start justify-center md:justify-start";

const overlayMap: Record<number, string> = {
  0:  "bg-[var(--brand-blue)]/0",
  20: "bg-[var(--brand-blue)]/20",
  30: "bg-[var(--brand-blue)]/30",
  40: "bg-[var(--brand-blue)]/40",
  50: "bg-[var(--brand-blue)]/50",
  60: "bg-[var(--brand-blue)]/60",
  70: "bg-[var(--brand-blue)]/70",
  80: "bg-[var(--brand-blue)]/80",
};

const overlayClass = overlayMap[overlayStrength] ?? overlayMap[40];
---

<section id={id} data-variant={variant} data-align={align} class={`section relative w-full isolate min-h-[60svh] md:min-h-[75svh] lg:min-h-[90svh] ${cls}`}>
  {variant === "image" && bgImage && (
    <div aria-hidden="true" class="absolute inset-0 -z-10 overflow-hidden">
      <img src={bgImage} alt="" class="h-full w-full object-cover" loading="eager" />
      <div class={`absolute inset-0 ${overlayClass}`}></div>
      <div class="pointer-events-none absolute inset-x-0 top-0 h-24 bg-gradient-to-b from-[var(--brand-dark)]/40 to-transparent"></div>
      <div class="pointer-events-none absolute inset-x-0 bottom-0 h-28 bg-gradient-to-t from-[var(--brand-light)]/40 to-transparent"></div>
    </div>
  )}

  {variant === "gradient" && (
    <div aria-hidden="true" class="absolute inset-0 -z-10">
      <div class="h-full w-full bg-gradient-to-br from-[var(--brand-blue)] via-[var(--brand-light)] to-[var(--brand-dark)]" />
    </div>
  )}

  {variant === "solid" && (
    <div aria-hidden="true" class="absolute inset-0 -z-10 bg-card dark:bg-[var(--brand-dark)]" />
  )}

  <div class={`container-prose px-6 md:px-8 h-full grid md:justify-center ${wrapAlign}`}>
    <div class={`flex flex-col ${align === "center" ? "mx-auto" : ""} max-w-[512px] md:max-w-2xl md:w-dvw`}>
      <!-- Grupo de textos -->
      <div class="flex flex-col gap-0 mb-14">
        <p class="body-sm text-disabled">{eyebrow}</p>

        <h1 class="heading-1 text-[var(--ui-text)]" set:html={title} />

        {description && (
          <p class="body-md text-[var(--ui-text)]">
            {description}
          </p>
        )}
      </div>

      <!-- Grupo de acciones (botÃ³n + icon-only a la derecha) -->
      {(showPrimary || Astro.slots.has("actions")) && (
        <div class={`flex flex-wrap items-ri gap-3 self-end ${align === "center" ? "mx-auto" : ""}`}>
          {showPrimary && primary && (
            <Button href={primary.href} variant="primary" size="sm" class="btn-primary">
              <slot name="primary-icon" />
              {primary.label}
            </Button>
          )}

          <div class="flex items-center gap-2">
            <slot name="actions" />
          </div>
        </div>
      )}
    </div>
  </div>
</section>