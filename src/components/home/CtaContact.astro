---
import Button from "../ui/Button.astro";
import Icon from "../ui/Icon.astro";
import Link from "../ui/Link.astro";

const liveId = `live-${Math.random().toString(36).slice(2)}`;
const email = "wavival.dev@luminaw.co";
---

<section aria-label="Contacto rápido" class="w-full flex flex-col gap-10 items-center px-[32px] py-9 backdrop-blur backdrop-saturate-150 bg-[var(--bg-card)] dark:bg-[var(--bg-card)]">
  <p class="text-body-xl font-bold text-[var(--brand-blue)] lg:max-w-[1024px] lg:w-full">A un clic</p>

  <div class="rounded-xl border border-[var(--accent-hover)] p-7 shadow-[var(--shadow-base)] flex flex-col items-center gap-7 h-[320px] justify-center">
    <h2 class="text-[28px] font-semibold text-center text-[var(--text-primary)]">¿Tienes una idea rondando en tu cabeza?</h2>
    <p class="mt-1.5 text-center text-[var(--text-primary)]">Cada proyecto empieza con una conversación.</p>
    <div class="mt-4">
        <Button href="mailto:contacto@lumina.dev" target="_blank" icon="ui/send-email-white" text="Contáctame" />
    </div>
  </div>

  <p class="text-[var(--text-primary)] text-center w-fit">Gracias por llegar hasta aquí. Tu idea podría ser el próximo diseño que cobre vida.</p>

  <div id="copy-email" class="flex items-center justify-between text-[var(--text-primary)] cursor-pointer relative backdrop-blur backdrop-saturate-150 bg-[var(--bg-blur)] dark:bg-[var(--bg-blur)] p-3 rounded-lg w-[260px]" data-copy-value={email} data-live-id={liveId} role="button" tabindex="0">
    <p>wavival.dev@luminaw.co</p>
    <Icon src="/icons/ui/copy-email.svg" size="md" class="shrink-0 transition-opacity duration-300" />
    <span id="copy-msg" class="absolute -bottom-6 left-[50%] translate-x-[-50%] text-sm text-[var(--brand-blue)] opacity-0 transition-opacity duration-300">Email copiado</span>
</div>

  <div class="flex flex-col items-center gap-5">
    <p class="text-center text-[var(--text-primary)]">Descubre más de mi mundo</p>
    <nav aria-label="Redes sociales" class="flex items-center gap-3">
        <Link href="https://wa.me/573021011753?text=Hola%2C%20me%20gustaria%20contratar%20un%20servicio" target="_blank" rel="noopener" class="inline-flex items-center justify-center w-11 h-11 rounded-md text-[var(--accent-link)] hover:bg-[var(--accent-link)]/10"><Icon src="/icons/social/whatsapp.svg" size="md" /></Link>
        <Link href="https://www.figma.com/@wavival" target="_blank" rel="noopener" class="inline-flex items-center justify-center w-11 h-11 rounded-md text-[var(--accent-link)] hover:bg-[var(--accent-link)]/10"><Icon src="/icons/social/figma.svg" size="md" /></Link>
        <Link href="https://www.platzi.com/p/wavival" target="_blank" rel="noopener" class="inline-flex items-center justify-center w-11 h-11 rounded-md text-[var(--accent-link)] hover:bg-[var(--accent-link)]/10"><Icon src="/icons/ui/see-demo.svg" size="md" /></Link>
    </nav>
  </div>

  <div>
    <Link href="/more/contact" rel="noopener" class="text-[var(--accent-link)] hover:bg-[var(--accent-link)]/10">Saber más</Link>
  </div>

  <span id={liveId} class="sr-only" aria-live="polite"></span>

  <script>
    const copyEl = document.getElementById("copy-email");
    const iconEl = copyEl?.querySelector("img");
    const msgEl = document.getElementById("copy-msg");

    copyEl?.addEventListener("click", () => {
        const value = copyEl.getAttribute("data-copy-value");
        if (!value) return;

        navigator.clipboard.writeText(value).then(() => {
        if (iconEl) {
            iconEl.style.opacity = "0";
            setTimeout(() => {
            iconEl.setAttribute("src", "/icons/ui/done.svg");
            iconEl.style.opacity = "1";
            }, 300);
        }

        if (msgEl) {
            msgEl.style.opacity = "1";
        }

        setTimeout(() => {
            if (iconEl) {
            iconEl.style.opacity = "0";
            setTimeout(() => {
                iconEl.setAttribute("src", "/icons/ui/copy-email.svg");
                iconEl.style.opacity = "1";
            }, 300);
            }
            if (msgEl) {
            msgEl.style.opacity = "0";
            }
        }, 3000);
        });
    });
    </script>
</section>